<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>XOVA Database Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .test-form {
            margin: 20px 0;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        .test-form input, .test-form button {
            margin: 10px 0;
            padding: 10px;
            width: 100%;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        .test-form button {
            background: #2c5530;
            color: white;
            border: none;
            cursor: pointer;
        }
        .test-form button:hover {
            background: #1e3a21;
        }
        .result {
            margin: 20px 0;
            padding: 15px;
            border-radius: 5px;
        }
        .success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üß™ XOVA Database Test</h1>
        <p>This page tests the Supabase connection and database tables for your XOVA landing page.</p>
        
        <div class="test-form">
            <h3>Test Waitlist Signup</h3>
            <input type="text" id="test-name" placeholder="Test Name" value="Test User">
            <input type="email" id="test-email" placeholder="test@example.com" value="test@example.com">
            <button onclick="testWaitlist()">Test Waitlist Insert</button>
            <div id="waitlist-result"></div>
        </div>
        
        <div class="test-form">
            <h3>Test Vote Submission</h3>
            <input type="email" id="vote-email" placeholder="test@example.com" value="test@example.com">
            <input type="text" id="vote-blend" placeholder="Blend Name" value="Foundation Blend">
            <button onclick="testVote()">Test Vote Insert</button>
            <div id="vote-result"></div>
        </div>
        
        <div class="test-form">
            <h3>Test Database Connection</h3>
            <button onclick="testConnection()">Test Supabase Connection</button>
            <div id="connection-result"></div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script>
        // Initialize Supabase
        const SUPABASE_URL = 'https://iphmzlmbsqqgapxlkqup.supabase.co';
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImlwaG16bG1ic3FxZ2FweGxrcXVwIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjAxODQ2MzMsImV4cCI6MjA3NTc2MDYzM30.FyBOcaxsKwGXpKWiyBAdeafUpVONHLTaBtR6MndVYPI';
        
        const { createClient } = supabase;
        const supabaseClient = createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

        async function testConnection() {
            const resultDiv = document.getElementById('connection-result');
            resultDiv.innerHTML = 'Testing connection...';
            
            try {
                const { data, error } = await supabaseClient
                    .from('waitlist')
                    .select('count')
                    .limit(1);
                
                if (error) {
                    resultDiv.innerHTML = `<div class="error">‚ùå Connection Error: ${error.message}</div>`;
                } else {
                    resultDiv.innerHTML = `<div class="success">‚úÖ Connection successful! Supabase is working.</div>`;
                }
            } catch (err) {
                resultDiv.innerHTML = `<div class="error">‚ùå Connection failed: ${err.message}</div>`;
            }
        }

        async function testWaitlist() {
            const resultDiv = document.getElementById('waitlist-result');
            const name = document.getElementById('test-name').value;
            const email = document.getElementById('test-email').value;
            
            resultDiv.innerHTML = 'Testing waitlist insert...';
            
            try {
                const { data, error } = await supabaseClient
                    .from('waitlist')
                    .insert([
                        { 
                            email: email,
                            name: name,
                            source: 'database_test',
                            created_at: new Date().toISOString()
                        }
                    ]);

                if (error) {
                    resultDiv.innerHTML = `<div class="error">‚ùå Waitlist Error: ${error.message}</div>`;
                } else {
                    resultDiv.innerHTML = `<div class="success">‚úÖ Waitlist insert successful! Check your Supabase dashboard.</div>`;
                }
            } catch (err) {
                resultDiv.innerHTML = `<div class="error">‚ùå Waitlist failed: ${err.message}</div>`;
            }
        }

        async function testVote() {
            const resultDiv = document.getElementById('vote-result');
            const email = document.getElementById('vote-email').value;
            const blend = document.getElementById('vote-blend').value;
            
            resultDiv.innerHTML = 'Testing vote insert...';
            
            try {
                const { data, error } = await supabaseClient
                    .from('votes')
                    .insert([
                        { 
                            email: email,
                            blend: blend,
                            reason: 'Database test',
                            created_at: new Date().toISOString()
                        }
                    ]);

                if (error) {
                    resultDiv.innerHTML = `<div class="error">‚ùå Vote Error: ${error.message}</div>`;
                } else {
                    resultDiv.innerHTML = `<div class="success">‚úÖ Vote insert successful! Check your Supabase dashboard.</div>`;
                }
            } catch (err) {
                resultDiv.innerHTML = `<div class="error">‚ùå Vote failed: ${err.message}</div>`;
            }
        }
    </script>
</body>
</html>
